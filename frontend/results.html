<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ranking - Speed Run Complexidade</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-gray-900 text-white min-h-screen flex items-center justify-center p-4">
    <div id="app" class="w-full max-w-4xl bg-gray-800 rounded-xl shadow-2xl p-6 md:p-10">
        
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-yellow-400">üèÜ Ranking Global</h1>
            <p class="text-gray-400 mt-2">Os mestres da complexidade de algoritmos.</p>
        </header>

        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-700">
                <thead class="bg-gray-700">
                    <tr>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">
                            Pos.
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">
                            Jogador
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">
                            Pontua√ß√£o
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">
                            Tempo Total (s)
                        </th>
                        <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">
                            Data
                        </th>
                    </tr>
                </thead>
                <tbody id="ranking-body" class="bg-gray-800 divide-y divide-gray-700">
                    <tr><td colspan="5" class="text-center py-4 text-gray-500">Carregando ranking...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="text-center mt-8">
            <a href="index.html" class="inline-block py-3 px-8 bg-teal-500 hover:bg-teal-600 text-white font-bold rounded-lg shadow-lg transition duration-300">Voltar ao Quiz</a>
        </div>
    </div>

    <script>
        const API_BASE_URL = "http://localhost:8000";
        const API_TOKEN = "super-secret-complexidade-token"; // Token Fixo (Deve ser o mesmo do main.py)

        async function loadRanking() {
            const rankingBody = document.getElementById('ranking-body');
            rankingBody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500">Carregando ranking...</td></tr>';

            try {
                // REQUISI√á√ÉO CORRIGIDA PARA INCLUIR O TOKEN
                const response = await fetch(`${API_BASE_URL}/results`, {
                    headers: {
                        'X-API-Token': API_TOKEN
                    }
                });
                
                if (response.status === 401) {
                    throw new Error('Erro de Autentica√ß√£o: Token API inv√°lido para carregar ranking.');
                }
                if (!response.ok) {
                    // Tenta ler a mensagem de erro da API se n√£o for 401
                    const errorText = await response.text();
                    throw new Error(`Falha ao carregar o ranking. Status: ${response.status}. Detalhe: ${errorText}`);
                }
                
                const results = await response.json();

                if (results.length === 0) {
                    rankingBody.innerHTML = '<tr><td colspan="5" class="text-center py-4 text-gray-500">Nenhum resultado registrado ainda. Seja o primeiro!</td></tr>';
                    return;
                }

                let html = '';
                results.forEach((row, index) => {
                    const dataFormatada = new Date(row.data).toLocaleString('pt-BR');
                    const tempoFormatado = row.tempo_total.toFixed(2);
                    
                    let posClass = 'text-gray-300';
                    if (index === 0) posClass = 'text-yellow-400 font-extrabold text-xl';
                    else if (index === 1) posClass = 'text-gray-300 font-bold text-lg';
                    else if (index === 2) posClass = 'text-amber-500 font-semibold';

                    html += `
                        <tr class="${index % 2 === 0 ? 'bg-gray-700' : 'bg-gray-800'} hover:bg-gray-600 transition duration-150">
                            <td class="px-6 py-4 whitespace-nowrap ${posClass}">${index + 1}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-white">${row.player_name}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-lg font-extrabold text-green-400">${row.pontos}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-400">${tempoFormatado}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${dataFormatada}</td>
                        </tr>
                    `;
                });
                rankingBody.innerHTML = html;

            } catch (error) {
                console.error(error);
                rankingBody.innerHTML = `<tr><td colspan="5" class="text-center py-4 text-red-400">Erro ao carregar ranking. ${error.message}</td></tr>`;
            }
        }

        window.onload = loadRanking;
    </script>
</body>
</html>